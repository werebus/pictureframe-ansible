---
- hosts: frames
  remote_user: alarm
  become: yes
  become_method: su
  gather_facts: no

  tasks:
    - name: 'install python'
      raw: 'pacman -S --needed --noconfirm --noprogressbar python'
    - user:
        name: '{{ admin_user }}'
        append: yes
        groups: wheel
        password: "{{ admin_user_password|password_hash('sha512') }}"
    - authorized_key:
        user: '{{ admin_user }}'
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
    - name: 'install sudo'
      pacman:
        name: sudo
        update_cache: yes
    - name: 'sudoers file'
      lineinfile:
        dest: /etc/sudoers
        state: present
        insertafter: '^# ?%wheel'
        line: '%wheel ALL=(ALL) NOPASSWD: ALL'
